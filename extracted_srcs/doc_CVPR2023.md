3D Registration with Maximal Cliques As a fundamental problem in computer vision , 3D point cloud registration ( PCR ) aims to seek the optimal pose to align a point cloud pair . In this paper , we present a 3D registration method with maximal cliques ( MAC ) . The key insight is to loosen the previous maximum clique constraint , and mine more local consensus information in a graph for accurate pose hypotheses generation : 1 ) A compatibility graph is constructed to render the affinity relationship between initial correspondences . 2 ) We search for maximal cliques in the graph , each of which represents a consensus set . We perform node-guided clique selection then , where each node corresponds to the maximal clique with the greatest graph weight . 3 ) Transformation hypotheses are computed for the selected cliques by the SVD algorithm and the best hypothesis is used to perform registration . Extensive experiments on U3M , 3DMatch , 3DLoMatch and KITTI demonstrate that MAC effectively increases registration accuracy , outperforms various state-of-the-art methods and boosts the performance of deep-learned methods . MAC combined with deep-learned methods achieves stateof-the-art registration recall of 95.7% / 78.9% on 3DMatch / 3DLoMatch . Given two 3D scans of the same object ( or scene ) , the goal of PCR is to estimate a six-degree-of-freedom ( 6 - DoF ) pose transformation that accurately aligns the two input point clouds . Using pointto-point feature correspondences is a popular and robust solution to the PCR problem . The problem of 3D registration by handling correspondences with outliers has been studied for decades . We classify them into geometric-only and deep-learned methods . For geometric-only methods [ 5 , 6 , 21 , 30 , 31 , [ 38 ] [ 39 ] [ 40 ] [ 41 ] , random sample consensus ( RANSAC ) and its variants perform an iterative sampling strategy for registration . Although RANSAC-based methods are simple and efficient , their performance is highly vulnerable when the outlier rate increases , and it requires a large number of iterations to obtain acceptable results . Also , a series of global registration methods based on branch-and-bound ( BnB ) are proposed to search the 6D parameter space and obtain the optimal global solution . Except for this watermark , it is identical to the accepted version ; the final published version of the proceedings is available on IEEE Xplore . one module in the registration process , such as investigating more discriminate keypoint feature descriptors or more effective correspondence selection techniques , while the others [ 22 , 29 , 43 ] focus on registration in an end-to-end manner . However , deep-learned based methods require a large amount of data for training and usually lack generalization on different datasets . In this paper , we propose a geometric-only 3D registration method based on maximal cliques ( MAC ) . The key insight is to loosen the previous maximum clique constraint , and mine more local consensus information in a graph to generate accurate pose hypotheses . Compared with the maximum clique , MAC is a looser constraint and is able to mine more local information in a graph . Finally , transformation hypotheses are computed for the selected cliques by the SVD algorithm . The best hypothesis is selected to perform registration using popular hypothesis evaluation metrics in the RANSAC family . To summarize , our main contributions are as follows : • We introduce a hypothesis generation method named MAC . Our MAC method is able to mine more local information in a graph , compared with the previous maximum clique constraint . Notably , our geometric-only MAC method outperforms several state-of-the-art deep learning methods [ 3 , 9 , 19 , 27 ] . MAC can also be inserted as a module into multiple deep-learned frameworks [ 1 , 10 , 18 , 29 , 43 ] to boost their performance . MAC combined with GeoTransformer achieves the state-of-the-art registration recall of 95.7% / 78.9% on 3DMatch / 3DLoMatch . Various geometric-only methods [ 6 , 8 , 20 , 36 , 45 ] have been proposed recently . Typically , RANSAC and its variants [ 5 , 13 , 30 , 31 , [ 38 ] [ 39 ] [ 40 ] remain the dominant approaches to the problem of estimating a 6 - DoF pose from correspondences . RANSAC iteratively samples correspondences from the initial set , generating and evaluating geometric estimations for each subset until a satisfactory solution is obtained . Efficient and robust evaluation metrics are extremely important for using RANSAC to achieve accurate registration . To address the current problems of timeconsuming and noise-sensitive evaluation metrics , [ 40 ] analyzes the contribution of inliers and outliers during the computation and proposed several metrics that can effectively improve the registration performance of RANSAC . For example , Rusu et al . [ 31 ] presented the simple consensus-based initial alignment ( SAC-IA ) method , which samples correspondences spread out on the point cloud and leverages the Huber penalty for evaluation . Graph cut RANSAC ( GC-RANSAC ) [ 5 ] uses the graph-cut algorithm before model re-fitting in the local optimization step . Compatibility-guided sample consensus ( CG-SAC ) [ 30 ] additionally considers the normal information of key points during the sampling process . Yang et al . [ 39 ] proposed the sample consensus by sampling compatibility triangles ( SAC-COT ) method , which generates estimations by ranking and sampling ternary loops from the compatibility graph . A series of globally optimal methods based on BnB have been proposed recently . Yang et al . [ 41 ] proposed globally optimal ICP ( GO-ICP ) , which rationalizes the planning of ICP update tasks at different stages , and its biggest advantage is that it minimizes the local optimum . Bustos and Chin [ 6 ] presented guaranteed outlier removal ( GORE ) , which calculates the tight lower bound and tight upper bound for each correspondence and reduces the size of correspondence set by rejecting true outliers . Motivated by GORE , Li [ 21 ] proposed a polynomial time outlier removal method , which seeks the tight lower and upper bound by calculating the costs of correspondence matrix ( CM ) and augmented correspondence matrix ( ACM ) . However , BnB techniques are sensitive to the cardinality of the input and are time-consuming for large-scale inputs . In addition to geometric-only methods , recent works also adopt deep learning techniques to perform PCR . FCGF [ 10 ] computes the features in a single pass through a fully convolutional neural network without keypoint detection . D3Feat [ 4 ] uses a fully convolutional network to obtain local information of point clouds and a joint learning framework to achieve 3D local feature detection and description . Predator [ 18 ] applies an attention mechanism to extract salient points in overlapping regions of the point clouds , thus achieving robust registration in the presence of low overlap rates . Spinnet [ 1 ] extracts local features which are rotationally invariant and sufficiently informative to enable accurate registration . Deep global registration ( DGR ) [ 9 ] and 3DReg-Net [ 27 ] classify a given correspondence by training endto-end neural networks and using operators such as sparse convolution and point-by-point MLP . PointDSC [ 3 ] explicitly explores spatial consistency for removing outlier correspondences and 3D point cloud registration . Fu et al . [ 14 ] proposed a registration framework that utilizes deep graph matching ( RGM ) that can find robust and accurate pointto-point correspondences . More recently , several methods [ 29 , 43 ] follow the detection-free methods and estimate the transformation in an end-to-end way . CoFiNet [ 43 ] extracts correspondences from coarse to fine without keypoint detection . GeoTransformer [ 29 ] learns geometric features for robust superpoint matching and is robust in low-overlap cases and invariant to rigid transformation . MAC ( c1 ) = ( c1 , c3 , c4 , c5 ) MAC ( c3 ) = ( c1 , c3 , c4 , c5 ) MAC ( c2 ) = ( c2 , c6 , c7 ) … MAC ( c9 ) = ( c1 , c9 , c10 ) MAC ( c10 ) = ( c1 , c9 , c10 ) Node-guided maximal cliques c7 c7 c6 c6 c2 c2 c5 c5 c4 c4 c3 c3 c1 c1 R3 , t3 c10 c10 c9 c9 c1 c1 While deep learning techniques have demonstrated a great potential for PCR , these methods require a large amount of training data and their generalization is not always promising . By contrast , MAC does not require any training data and achieves more advanced performance than several deep-learned methods . Moreover , MAC can be served as a drop-on module in deep learning frameworks to boost their performance . An initial correspondence set C initial = { c } is formed by matching feature descriptors , where c = ( p s , p t ) . MAC estimates the 6 - DoF pose transformation between P s and P t from C initial . Here , we consider two approaches to construct a compatibility graph . • First Order Graph . The first order graph ( FOG ) is constructed based on the rigid distance constraint between the correspondence pair ( c i , c j ) , which can be quantitatively measured as : EQUATION The compatibility score between c i and c j is given as : EQUATION where d cmp is a distance parameter . Since the compatibility graph is undirected , the weight matrix W F OG is symmetric . • Second Order Graph . The second order graph ( SOG ) evolves from FOG . The weight matrix W SOG can be calculated as : EQUATION where ⊙ represents the element-wise product between two matrices . In Sec . 4.5 , we experimentally compare FOG and SOG in our MAC framework . A maximal clique is a clique that cannot be extended by adding any nodes . In particular , the maximal clique with the most nodes is the maximum clique of a graph . Searching for Maximal cliques . To generate hypotheses , RANSAC-based methods repeatedly take random samples from the correspondence set . Previous works [ 23 , 24 , 28 , 36 ] focus on searching for maximum cliques in the graph , however , the maximum clique is a very tight constraint that only focuses on the global consensus information in a graph . Instead , we loosen the constraint and leverage maximal cliques to mine more local graph information . By using the igraph maximal cliques function in the igraph 1 C + + library , which makes use of a modified Bron-Kerbosch algorithm [ 12 ] , the search of maximal cliques can be very efficient . Node-guided Clique Selection . First , we calculate the weight for each clique in MAC initial . Given a clique C i = ( V i , E i ) , the weight w Ci is calculated as : EQUATION where w ej represents the weight of edge e j in W SOG . A node may be included by multiple maximal cliques and we 1 https : / / igraph.org only retain the one with the greatest weight for that node . Then , duplicated cliques are removed from the rest , obtaining MAC selected . We could send these maximal cliques directly to the following stages for 3D registration . However , when | V | is quite large , the number of retained maximal cliques can still be very large . Here , we propose several techniques to further filter the maximal cliques . • Normal consistency . In the maximal cliques , we find that the normal consistency is satisfied between each correspondence . The following inequality ought to hold if c i and c j are normal consistent : EQUATION where t α is a threshold for determining whether the angular differences are similar . • Clique ranking . We organize MAC selected in a descending order using the clique's weight w Ci . Each maximal clique filtered from the previous step represents a consistent set of correspondences . By applying the SVD algorithm to each consistency set , we can obtain a set of 6 - DoF pose hypotheses . • Instance-equal SVD . Transformation estimation of correspondences is often implemented with SVD . Instance-equal means that the weights of all correspondences are equal . • Weighted SVD . Assigning weights to correspondences is commonly adopted by recent PCR methods [ 8 , 9 , 27 , 29 ] . Here , we take the primary eigenvalues of W SOG as correspondence weights . The final goal of MAC is to estimate the optimal 6 - DoF rigid transformation ( composed of a rotation pose R * ∈ SO ( 3 ) and a translation pose t * ∈ R 3 ) that maximizes the objective function as follow : EQUATION where c i ∈ C initial , N = | C initial | , and s ( c i ) represents the score of c i . We consider several RANSAC hypothesis evaluation metrics here [ 40 ] , including mean average error ( MAE ) , mean square error ( MSE ) and inlier count . The best hypothesis is taken to perform 3D registration then . We consider four datasets , i.e , the objectscale dataset U3M [ 26 ] , the scene-scale indoor datasets 3DMatch [ 44 ] & 3DLoMatch [ 18 ] , and the scene-scale outdoor dataset KITTI [ 15 ] . U3M has 496 point cloud pairs . 3DLoMatch is the subset of 3DMatch , where the overlap rate of the point cloud pairs ranges from 10% to 30% , which is very challenging . For KITTI , we follow [ 3 , 8 ] and obtain 555 pairs of point clouds for testing . In addition , we employ the rotation error ( RE ) and translation error ( TE ) to evaluate the registration results on the scene-scale dataset . By referring to the settings in [ 9 ] , the registration is considered successful when the RE ≤ 15 ° , TE ≤ 30 cm on 3DMatch & 3DLoMatch datasets , and RE ≤ 5 ° , TE ≤ 60 cm on KITTI dataset . We define a dataset's registration accuracy as the ratio of success cases to the number of point cloud pairs to be registered . Our method is implemented in C + + based on the point cloud library ( PCL ) [ 32 ] and igraph library . For U3M , we use the Harris3D ( H3D ) [ 33 ] keypoint detector and the signatures of histograms of orientation ( SHOT ) [ 34 ] descriptor for initial correspondence generation as in [ 42 ] . For 3DMatch and 3DLoMatch datasets , we use the fast point features histograms ( FPFH ) [ 31 ] descriptor and fully convolutional geometric features ( FCGF ) [ 10 ] descriptor to generate the initial correspondence set . Here , the following methods are tested , including SAC-COT [ 39 ] , OSAC [ 37 ] , SAC-IA [ 31 ] , RANSAC [ 13 ] , SC 2 - PCR [ 8 ] , FGR [ 45 ] , GO-ICP [ 41 ] , and PPF [ 11 ] , where the former four are RANSAC-based methods . The results indicate that MAC performs best and significantly outperforms all tested RANSAC-fashion estimators , such as SAC-COT , OSAC , SAC-IA , and RANSAC . The registration performance of MAC based on the MAE evaluation metric is the best on U3M . PCR methods comparison . Both geometric-only and deep-learned methods are considered for comparison , including SM [ 20 ] , FGR [ 45 ] , RANSAC [ 13 ] , TEASER + + [ 36 ] , CG-SAC [ 30 ] , SC 2 - PCR [ 8 ] , 3DRegNet [ 27 ] , DGR [ 9 ] , DHVR [ 19 ] and PointDSC [ 3 ] . The following conclusions can be made : 1 ) regardless of which descriptor is used , MAC outperforms all compared methods on both 3DMatch and 3DLoMatch datasets , indicating its strong ability to register indoor scene point clouds ; 2 ) even compared with deep-learned methods , MAC still achieves better performance without any data training ; 3 ) in addition to the registration recall ( RR ) metric , MAC achieves the best RE and TE metrics . This indicates that registrations by MAC are very accurate and MAC is able to align low overlapping data . Boosting deep-learned methods with MAC . Several kinds of state-of-the-art deep-learned methods are integrated with MAC for evaluation . The considered methods are FCGF [ 10 ] , SpinNet [ 1 ] , Predator [ 18 ] , CoFiNet [ 43 ] and Geo-Transformer [ 29 ] . Remarkably , MAC dramatically improves the registration recall under all tested methods on both 3DMatch and 3DLoMatch datasets . Notably , the performance of Spin-Net , Predator and CoFiNet after boosting by MAC exceeds In Table 4 , the results of DGR [ 9 ] , PointDSC [ 3 ] , TEASER + + [ 36 ] , RANSAC [ 13 ] , CG-SAC [ 30 ] , SC 2 - PCR [ 8 ] and MAC are reported for comparison . As shown by the table , in terms of the registration recall performance , MAC presents the best and is tied for the best results with FPFH and FCGF descriptor settings , respectively . MAC also has a lower TE than the state-ofthe-art geometric-only method SC 2 - PCR . The registration experiments on the object , indoor scene , and outdoor scene datasets consistently verify that MAC holds good generalization ability in different application contexts . In this section , we perform ablation studies and analysis experiments on both 3DMatch and 3DLoMatch datasets . Table 8 presents the time efficiency analysis of MAC . Performing feature matching selection . Before 3D registration , a popular way is to perform outlier rejection to reduce the correspondence set . Here we employ geometric consistency ( GC ) [ 7 ] , which is independent of the feature space and associates the largest consistent cluster relating to the compatibility among correspondences . This demonstrates that MAC can still perform well even if the initial correspondence set is directly utilized as input without any filtering . We test the performance of MAC by using different graph construction approaches . Also , the registration recall obtained by using SOG is 0.12% higher than using FOG when combined with FPFH , and 0.56% higher when combined with FCGF on 3DLoMatch . Therefore , SOG is more suitable for MAC . Maximum or maximal clique . To justify the advantages of maximal cliques , we change the search strategy of MAC to the maximum cliques and test the registration performance . As shown in Row 1 and 9 in Table 5 , applying maximal cliques surpasses maximum by 9.8% when combined with FPFH , and 5.55% higher when combined with FCGF on 3DMatch . Besides , the registration recall obtained by using maximal cliques is 8.03% higher than using the maximum cliques when combined with FPFH and 10.45% higher when combined with FCGF on 3DLoMatch . There are several reasons for this : 1 ) maximal cliques include the maximum cliques and additionally consider local graph constraints , so the search for maximal cliques can make use of both local and global information in the compatibility graph ; 2 ) the maximum clique is a very tight constraint which requires maximizing the number of mutually compatible correspondences , but it does not guarantee the opti-mal result . Node-guided clique selection . We compare the performance with and without node-guided ( NG ) clique selection for maximal cliques search . Comparing Row 1 and 4 in Table 5 , using NG achieves a recall improvement of 0.37% when combined with FPFH , and 0.5% improvement when combined with FCGF on 3DMatch . Also , using NG achieves a recall improvement of 0.23% with FPFH and 0.73% improvement with FCGF on 3DLoMatch . It is worth noting that while NG improves recall , the mean RE and mean TE are also decreasing . For example , NG reduces the mean RE by 0.1 ° and the mean TE by 0.11 cm with FPFH on 3DLoMatch . Different approaches for clique filtering . We test the effectiveness of the two filtering methods , normal consistency and clique ranking . 1 ) Normal consistency : comparing Row 1 and 8 in Table 5 , NC slightly degrades MAC's performance . 2 ) Clique ranking : Row 10 to 14 demonstrate that the registration recall tends to increase as K increases , suggesting that larger K yields a subset of cliques that generate more correct hypotheses . Employing instance-equal or weighted SVD . The comparisons of instance-equal and weighted SVD are shown in Rows 1 and 5 of Table 5 Weighted SVD is slightly inferior to instance-equal SVD . This suggests that samples in MACs are already very consistent , indicating no additional weighting strategies are required . Here we compare three evaluation metrics , including MAE , MSE and inlier count , for MAC hypothesis evaluation . As shown in Row 1 , 6 and 7 , MAC with MAE achieves the best performance . In Table 5 , MAE achieves a recall improvement of 0.24% when combined with FPFH , and 0.31% improvement when combined with FCGF on 3DMatch compared with the commonly used inlier count metric . Also , MAE has a 1.74% improvement when combined with FPFH , and 0.05% when combined with FCGF on 3DLoMatch compared with inlier count . MAE is also very effective in reducing RE and TE . Comparison with RANSAC hypotheses . We evaluate the quality of the generated hypotheses by comparing the hypotheses from RANSAC and MAC with the ground truth transformation . Compared to RANSAC , which randomly selects correspondences and generates hypotheses from the correspondence set without geometric constraints , MAC effectively generates more convincing hypotheses from maximal cliques in the compatibility graph , which fully exploits the consensus information in the graph . The performance upper bound of MAC . This can test the performance upper bound of MAC . We vary the judging threshold for the number of generated correct hypotheses and report the results in Impressively , MAC - 1 achieves registration recalls of 98.46% / 91.24% on 3DMatch / 3DLoMatch . This indicates that even on low overlapping datasets , MAC is able to produce correct hypotheses for most point cloud pairs . In addition , we can deduce that MAC's performance can be further improved with better hypothesis evaluation metrics . Time consumption of MAC . The following observations can be made . 1 ) In general , MAC can complete 3D registration in only tens of milliseconds when the number of correspondences is smaller than 1000 . Note that MAC is implemented on the CPU only . 2 ) As the number of correspondences increases from 250 to 2500 , there is an increase in time cost for graph construction due to W SOG computation taking more time . 3 ) When the number of correspondences reaches 5000 , there is a large rise in the time cost of MAC's registration . The significant increase in the input size makes the search for maximal cliques more timeconsuming . However , MAC is not sensitive to the cardinality of the input correspondence set , as verified in Table 3 . Hence , using sparse inputs for MAC can produce outstanding performance while making registration efficient . In this paper , we presented MAC to solve PCR by using the maximal clique constraint to generate precise pose hypotheses from correspondences . Our method achieves state-of-the-art performance on all tested datasets and can adapt to deep-learned methods to boost their performance . As shown in Table 7 and Table 1 , MAC produces accurate hypotheses but may fail to find them .