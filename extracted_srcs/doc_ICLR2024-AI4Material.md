MOFDIFF : COARSE-GRAINED DIFFUSION FOR METAL-ORGANIC FRAMEWORK DESIGN Metal-organic frameworks ( MOFs ) are of immense interest in applications such as gas storage and carbon capture due to their exceptional porosity and tunable chemistry . In this work , we propose MOFDiff : a coarse-grained ( CG ) diffusion model that generates CG MOF structures through a denoising diffusion process over the coordinates and identities of the building blocks . Equivariant graph neural networks are used for the diffusion model to respect the permutational and roto-translational symmetries . A denoising diffusion process conditional on z generates the building block identities and coordinates . To address the challenges above , we propose MOFDiff , a coarse-grained diffusion model for generating 3D MOF structures that leverages the modular and hierarchical structure of MOFs ( Figure 1 ( a ) ) . We train MOFDiff on BW-DB and use MOFDiff to generate and optimize MOF structures for carbon capture . We propose to learn a contrastive embedding to represent the vast building block design space . • We formulate a diffusion process for generating coarse-grained MOF 3D structures . In order to construct a compact representation of building blocks for diffusion-based modeling , we use a contrastive learning approach [ Hadsell et al . , 2006 , Chen et al . , 2020 ] to embed building blocks into a low dimensional latent space . A building block i is encoded as a vector b i using a GemNet-OC encoder [ Gasteiger et al . , 2021 [ Gasteiger et al . , , 2022 ] ] , an SE ( 3 ) - invariant graph neural network model . We then train the GNN building block encoder using a contrastive loss to map small geometric variations of the same building block to similar latent vectors in the embedding space . The projected embedding is obtained by projecting the building block embedding b i using a multi-layer perceptron ( MLP ) projection head : s i , j = ⋯ ⋯ ⋯ ⋯ ⋯ p i = MLP ( b i ) . MOFDiff . The MOFDiff model is composed of four components ( Figure 1 ( a ) ) : ( 1 ) A periodic GemNet-OC encoder5 that outputs a latent vector z = PGNN E ( M C ) ; ( 2 ) an MLP predictor that predicts the lattice parameters and the number of building blocks from the latent code z : L , K = MLP L , K ( z ) ; ( 3 ) a periodic GemNet-OC denoiser that outputs SE ( 3 ) - equivariant scores to denoise random structures to CG MOF structures conditional on the latent code : s A C , s X C = PGNN D ( M C t , z ) , where s A C , s X C are the predicted scores for building block identities A C and coordinates X C , and M C t is a noisy CG structure at time t in the diffusion process ; ( 4 ) an MLP predictor that predicts properties c ( such as CO 2 working capacity ) from z : ĉ = MLP P ( z ) . We design an assembly algorithm that optimizes the building block orientations to match the connection points of adjacent building blocks such that the MOF becomes connected ( visualized in Figure 4 ) . This optimization algorithm places Gaussian densities at the position of each connection point and maximizes the overlap of these densities between compatible connection points . The radius of the Gaussian densities is gradually reduced in the optimization process : at the beginning , the radius is high , so the optimization problem is smoother , and it is simpler to find an approximate solution . Details regarding the assembly algorithm are included in Appendix A .2 . Our experiments aim to evaluate two capabilities of MOFDiff : 1 . Can MOFDiff design functional MOF structures optimized for carbon capture ? We train and evaluate our method on the BW-DB dataset , which contains 304k MOFs with less than 20 building blocks ( as defined by the metal-oxo decomposition algorithm ) from the 324k MOFs in Boyd et al . 2019 . We use 289k MOFs ( 95% ) for training and the rest for validation . We do not keep a test split , as we evaluate our generative model on random sampling and inverse design capabilities . For the relaxed structure , we adopt MOFChecker [ Jablonka , 2023 ] to check validity . MOFChecker includes a variety of criteria : the presence of metal and organic elements , porosity , no overlapping atoms , no non-physical atomic valences or coordination environments , no atoms or molecules disconnected from the primary MOF structure , and no excessively large atomic charges . For novelty , we adopt the MOF identifier extracted by MOFid and say a MOF is novel if its MOFid differs from any other MOFs in the training dataset . We also count the number of unique generations by filtering out replicate samples using their MOFid . MOFDiff generates valid and novel MOFs . We randomly sample 10,000 latent vectors from N ( 0 , I ) , decode through MOFDiff , assemble , and apply force field relaxation to obtain the atomic structures . For faithful evaluation , we carry out grand canonical Monte Carlo ( GCMC ) simulations to calculate the gas adsorption properties of MOF structures . In the appendix , Figure 11 shows the benchmark results of our implementation compared to the original labels of BW-DB , which demonstrate a strong positive correlation with our implementation underestimating the original labels by an average of around 30% . MOFDiff is trained over the original BW-DB labels and uses latent-space optimization to maximize the BW-DB property values . MOFDiff discovers promising candidates for carbon capture . After conducting the validity checks described in Section 4.1 , we find 2054 MOFs that are valid , novel , and unique ( Figure 8 ( a ) ) . These 2054 MOFs are then simulated with our GCMC workflow to compute gas adsorption properties . Given the systematic differences between the original labels of BW-DB and those calculated with our reimplemented GCMC workflow , we randomly sampled 5,000 MOFs from the BW-DB dataset and recalculated the gas adsorption properties using our GCMC workflow to provide a fair baseline for comparison . We observe that MOFDiff From an efficiency perspective , GCMC simulations take orders of magnitude more computational time ( tens of minutes to hours ) than other components of the MOF design pipeline ( seconds to tens of seconds ) . These simulations can also be made more accurate at significantly higher computational costs ( days ) by converging sampling to tighter confidence intervals or using more advanced techniques , such as including blocking spheres , which prohibit Monte Carlo insertion of gas molecules into kinetically prohibited pores of the MOF , and calculating atomic charges with density functional theory ( DFT ) . Therefore , the efficiency of a MOF design pipeline can be evaluated by the average number of GCMC simulations required to find one qualifying MOF for carbon capture applications . Naively sampling from the BW-DB dataset requires , on average , 58.1 GCMC simulations to find one MOF with a working capacity of more than 2 mol / kg . Beyond efficiency , MOFDiff's generation flexibility also allows it to discover top MOF candidates that are outstanding for carbon capture . We compute gas adsorption properties of 18 MOFs that have been investigated for CO 2 adsorption from previous literature [ Madden et al . , 2017 , Coelho et al . , 2016 , González-Zamora and Ibarra , 2017 , Boyd et al . , 2019 ] using our GCMC simulation workflow . MOFDiff can discover highly promising candidates , making up 9 out of the top 10 MOFs . This comparison confirms MOFDiff's capability in advancing functional MOF design . We proposed MOFDiff , a coarse-grained diffusion model for metal-organic framework design . Our work presents a complete pipeline of representation , generative model , structural relaxation , and molecular simulation to address a specific carbon capture materials design problem . We then design an assembly algorithm to realize the all-atom MOF structures and characterize their properties with molecular simulations . MOFDiff can generate valid and novel MOF structures covering a wide range of structural properties as well as optimize MOFs for carbon capture applications that surpass state-of-the-art MOFs in molecular simulations .