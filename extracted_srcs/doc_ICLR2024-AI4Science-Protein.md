A Multi-Grained Symmetric Differential Equation Model for Learning Protein-Ligand Binding Dynamics In drug discovery , molecular dynamics ( MD ) simulation for protein-ligand binding provides a powerful tool for predicting binding affinities , estimating transport properties , and exploring pocket sites . There has been a long history of improving the efficiency of MD simulations through better numerical methods and , more recently , by utilizing machine learning ( ML ) methods . To address this issue , we propose NeuralMD , the first ML surrogate that can facilitate numerical MD and provide accurate simulations in protein-ligand binding . Specifically , we propose ( 1 ) a BindingNet model that satisfies group symmetry using vector frames and captures the multi-level protein-ligand interactions , and ( 2 ) an augmented neural differential equation solver that learns the trajectory under Newtonian mechanics . For the experiment , we design ten single-trajectory and three multi-trajectory binding simulation tasks . We show the efficiency and effectiveness of NeuralMD , with a 2000 × speedup over standard numerical MD simulation and outperforming all other ML approaches by up to ~ 80% under the stability metric . We further qualitatively show that NeuralMD reaches more stable binding predictions compared to other machine learning methods . The molecular dynamics ( MD ) simulation for protein-ligand binding is one of the fundamental tasks in drug discovery [ 1 , 2 , 3 , 4 ] . To simulate the protein-ligand dynamics , numerical MD methods have been extensively developed [ 5 , 6 ] . To alleviate this issue , machine learning ( ML ) surrogates have been proposed to either augment or replace numerical MD methods to estimate the MD trajectories . However , all prior ML approaches for MD simulation are limited to single-system ( e.g . , either small molecules or proteins ) and not protein-ligand complex [ 7 , 8 , 9 ] . A primary reason is the lack of large-scale datasets for protein-ligand binding . Another critical aspect that needs to be considered in ML-based modeling is the group symmetry present in the proteinligand geometry . Specifically , the geometric function over molecular systems should be equivariant to rotation and translation , i.e . , SE ( 3 ) - equivariance . DenoisingLD , exhibiting a lower degree of torsion with the natural conformations . Other methods collapse heavily , including GNN-MD and VerletMD , where atoms extend beyond the frame for the latter . Our Approach : NeuralMD . Further , our ML approach NeuralMD preserves the Newtonian mechanics . In MD , the movement of atoms is determined by Newton's second law , F = m • a , where F is the force , m is the mass , and a is the acceleration of each atom . Thus in NeuralMD , we formulate the trajectory simulation as a second-order ordinary differential equation ( ODE ) or second-order stochastic differential equation ( SDE ) problem . To verify the effectiveness and efficiency of NeuralMD , we design ten single-trajectory and three multitrajectory binding simulation tasks . We observe that NeuralMD outperforms all other ML methods [ 9 , 23 , 24 , 25 , 26 ] on 12 tasks using recovery metric , and NeuralMD is consistently better by a large gap using the stability metric ( up to ~ 80% ) . They are three protein-ligand binding complexes from Protein Data Bank ( PDB ) , as shown in Figure 1 . In addition to the backbone level , as a coarser-grained view , we further consider residue-level information for modeling binding interactions , { f ( p ) , x x x ( p ) } , where the coordinate of C α is taken as the residue-level coordinate , i.e . , x x x ( p ) ≜ x x x ( p ) C α . Molecular Dynamics Simulations . Generally , molecular dynamics ( MD ) describes how each atom in a molecular system moves over time , following Newton's second law of motion : EQUATION where F is the force , m is the mass , a is the acceleration , x x x is the position , and t is the time . The numerical MD methods can be classified into classical MD and ab-initio MD , where the difference lies in how the force on each atom is calculated : classical MD uses force field approaches to predict the atomic forces [ 5 ] , while ab-initio MD calculates the forces using quantum mechanical methods , such as density functional theory ( DFT ) [ 6 ] . More recently , ML MD methods have opened a new perspective by utilizing the group symmetric tools for geometric representation and energy prediction [ 11 , 12 , 13 , 14 , 15 , 17 , 18 , 19 , 27 ] , as well as the automatic differential tools for trajectory learning [ 28 , 29 , 30 , 31 , 32 , 33 ] . Newtonian Dynamics and Langevin Dynamics . Newtonian dynamics is suitable for idealized systems with negligible thermal effects or when deterministic trajectories are required , while Langevin dynamics is adopted where thermal effects play a significant role and when the system is being studied at a finite temperature . In this work , we propose two versions : an ordinary differential equation ( ODE ) solver and a stochastic differential equation ( SDE ) solver concerning Newtonian dynamics and Langevin dynamics , respectively . Noticeably , our experiential dataset , MISATO [ 10 ] , uses Newtonian dynamics with Langevin thermostats , and the information on solvent molecules is not provided . We also want to clarify two critical points about this problem setting : ( 1 ) Our task is trajectory prediction , i.e . , positions as labels , and no explicit energy and force are considered as labels . ML methods for energy prediction followed with numerical ODE / SDE solver require smaller timestep ( e.g . , 1e - 15 seconds ) , while trajectory prediction , which directly predicts the coordinates over time , is agnostic to the magnitude of the timestep . It has two main phases : ( 1 ) A multi-grained SE ( 3 ) - equivariant geometric model , BindingNet . It models the protein-ligand complex from three granularities , employing three levels of vector frame basis : atom level for ligands , backbone level for proteins , and residue level for protein-ligand complexes . ( 2 ) A second-order ordinary differential equation ( ODE ) solver and a second-order stochastic differential equation ( SDE ) to learn the Newtonian mechanics . We further introduce two attributes : a derivative-space augmentation method for the efficient second-order solver and a conditional adjoint solver for lower memory costs . This section outlines the structure : the three levels of vector frames in Section 3.1 , the architecture of BindingNet for protein-ligand force prediction in Section 3.2 , the design of NeuralMD for trajectory simulation in Section 3.3 , and implementation details in Section 3.4 . To address this issue , we propose BindingNet , a multi-grained SE ( 3 ) - equivariant model , to capture the interactions between a ligand and a protein . Such a group symmetric property is called SE ( 3 ) - equivariance . Atom-Level Vector Frame for Ligands . For each residue in the protein , the coordinates are x x x N , x x x C α , and x x x C , then the backbone-level vector frame for this residue is : EQUATION This is built for each residue , enabling the message passing for a residue-level representation . Residue-Level Vector Frame for Protein-Ligand Complexes . In this section , we introduce BindingNet , a multi-grained SE ( 3 ) - equivariant geometric model for protein-ligand binding . The input of BindingNet is the geometry of the rigid protein and the ligand at time t , while the output is the force on each atom in the ligand . Atom-Level Ligand Modeling . We first generate the atom embedding using one-hot encoding and then aggregate each atom's embedding , z z z ( l ) , by aggregating all its neighbor's embedding within the cutoff distance c . Finally , it is passed through several equivariant message-passing layers ( MPNN ) defined as : EQUATION where MLP ( • ) and Agg ( • ) are the multi-layer perceptron and mean aggregation functions , respectively . vec ∈ R 3 is a vector assigned to each atom and is initialized as 0 . The outputs are atom representation and vector ( h h h ( l ) and vec ( l ) ) , and they are passed to the complex module introduced below . Backbone-Level Protein Modeling . For the coarse-grained modeling of proteins , we consider three backbone atoms in each residue . Then , we obtain an equivariant atom representation by aggregating the edge information , ( x x x ( p ) i - x x x ( p ) j ) • z z z ( p ) i , within cutoff distance c . Finally , we adopt an equivariant MPNN layer to get the atom-level force as : EQUATION The ultimate force predictions for each atom include two parts : the internal force from the molecule vec ( l ) i and the external force from the protein-ligand interaction vec ( pl ) i j . So sum them up , we have : EQUATION These three modules consist BindingNet . The BindingNet introduced in Sections 3.1 and 3.2 takes in the molecular system geometry at time t and outputs the forces . Then in this section , we describe how we use the neural differential equation solver to predict the coordinates at future snapshots . We want to highlight that one ML for MD simulation research line is predicting the energy or force [ 36 , 23 , 9 ] , which will be fed into the numerical integration algorithms for trajectory simulation . For accuracy , such an ML-based MD simulation must be at the femtosecond level ( 1e - 15 second ) . However , as shown in recent works [ 37 , 38 , 21 ] , minor errors in the ML force field can lead to catastrophic failure for long-time simulations . In this paper , however , we overcome this issue by directly learning the extended-timescale MD trajectories ( nanosecond level , 1e - 9 second ) . Newtonian dynamics and Langevin dynamics for MD simulation . For modeling , we consider using the BindingNet introduced above for force prediction at time τ , as : EQUATION On the other hand , Langevin dynamics introduces a stochastic component for large molecular systems with thermal fluctuations . Ultimately , adopting either F ( l ) τ - ODE or F ( l ) τ - SDE as the force prediction F ( l ) τ on each atom , the coordinates at time t can be obtained after integration as : EQUATION ) The training objective is the mean absolute error ( MAE ) between the predicted coordinates and ground-truth coordinates along the whole trajectories : EQUATION ) An illustration of NeuralMD pipeline is in Figure 4 . Adjoint method . Specifically for protein-ligand complexes with a large volume of atoms , the memory costs have become a main challenge . To handle this , we consider the adjoint method [ 28 ] , allowing small step sizes in the integration . Roughly speaking , the adjoint method calculates the variational derivative of the trajectory w.r.t . our objective function directly . Second-order differential equation . The key module of the neural differential method is the differential function [ 28 ] , which returns the first-order derivative . To learn the MD trajectory following second-order ODE and SDE , we propose the following formulation of the second-order equation within one integration call : EQUATION ) We mark this as " func " in Figure 4 . This means we can augment ODE or SDE derivative space by concurrently calculating the accelerations and velocities , allowing simultaneous integration of velocities and positions . In this section , we would like to include extra details of NeuralMD . As in Equations ( 11 ) and ( 13 ) , both the coordinates and velocities are required inputs for NeuralMD . To handle this issue , we propose a surrogate velocity , which is a summation of a predicted velocity by an extra equivariant model and a coordinate momentum , i.e . , v v v ( l ) t = BindingNet-Ligand ( f ( l ) , x x x ( l ) t ) + ( x x x ( l ) t + 1 - x x x ( l ) t ) , where the BindingNet-Ligand is the ligand model described in Section 3.2 . Update model BindingNet using gradient descent . 9 : end for 10 : end for 4 Experiments Datasets . One of the main bottlenecks of studying ML for molecular dynamics simulation in protein-ligand binding is insufficient data . Recently , the community has put more effort into gathering the datasets , and we consider MISATO in our work [ 10 ] . It is built on 16,972 experimental protein-ligand complexes extracted from the protein data bank ( PDB ) [ 39 ] . Such data is obtained using X-ray crystallography , Nuclear Magnetic Resonance ( NMR ) , or Cryo-Electron Microscopy ( Cryo-EM ) , where systematic errors are unavoidable . For each protein-ligand complex , the trajectory comprises 100 snapshots in 8 nanoseconds under the fixed temperature and pressure . In Appendix E , we list the basic statistics of MISATO , e.g . , the number of atoms in small molecule ligands , and the number of residues in proteins . Using ML for energy and force prediction , followed by trajectory prediction using numerical integration method , has been widely explored in the community , e.g . , HDNNPs [ 7 ] , DeePMD [ 9 ] , TorchMD [ 36 ] , and Allegro-LAMMPS [ 23 ] . Here we extend this paradigm for binding dynamics and propose VerletMD , which utilizes BindingNet for energy prediction on each snapshot and velocity Verlet algorithm to get the trajectory . Additionally , we mainly focus on ML methods for trajectory prediction in this work , i.e . , no energy or force is considered as labels . GNN-MD is to apply geometric graph neural networks ( GNNs ) to predict the trajectories in an auto-regressive manner [ 10 , 24 ] . More concretely , GNN-MD takes the coordinates and other molecular information as inputs at time t and predicts the coordinates at time t + 1 . DenoisingLD ( denoising diffusion for Langevin dynamics ) [ 24 , 25 , 26 ] is a baseline method that models the trajectory prediction as denoising diffusion task [ 40 ] , and the inference for binding trajectory essentially becomes the Langevin dynamics . Here , to make the comparison more explicit , we compare these two methods ( GNN-MD and DenoisingLD ) separately . We want to highlight that we keep the same backbone model , BindingNet , for energy or force prediction for all the baselines and NeuralMD . To evaluate this , we take both the mean absolute error ( MAE ) and mean squared error ( MSE ) between the predicted coordinates and ground-truth coordinates over all snapshots . Stability , as highlighted in [ 21 ] , is an important metric for evaluating the predicted MD trajectory . The intuition is that the prediction on long-time MD trajectory can enter a pathological state ( e.g . , bond breaking ) , and stability is the measure to quantify such observation . Another metric considered is frames per second ( FPS ) [ 21 ] on a single Nvidia-V100 GPU card , and it measures the MD efficiency . The first observation is that the baseline VertletMD has a clear performance gap compared to the other methods . There are two possible reasons : ( 1 ) Using ML models to predict the energy ( or force ) at each snapshot , and then using a numerical integration algorithm can fail in the long-time simulations [ 21 ] ; ( 2 ) ML for energy prediction methods require more data to train than the ML for coordinate prediction methods , thus they can perform worse in the low-data regime here . However , the stability ( % ) can be a distinctive factor in method comparisons , where we observe the two variants of NeuralMD outperform on all 10 tasks up to ~ 80% . It is shown that the GNN-MD collapses occasionally , while DenoisingLD stays comparatively structured . Meanwhile , NeuralMD is the most stable in all cases . One main benefit of using NeuralMD for binding simulation is its efficiency . We further approximate the wall time of the numerical method for MD simulation ( PDB 5WIJ ) . A more challenging task is to test the generalization ability of NeuralMD among different trajectories . The MISATO dataset includes 13,765 protein-ligand complexes , and we first create two small datasets by randomly sampling 100 and 1k complexes , respectively . We also consider the whole MISATO dataset , where the data split has already been provided . First , we can observe that VerletMD has worse performance on all three datasets , and the performance gap with other methods is even larger compared to the single-trajectory prediction . The other two baselines , GNN-MD and DenoisingLD , show similar performance , while NeuralMD outperforms in all datasets . Notice that stability ( % ) remains more distinguishable than the two trajectory recovery metrics ( MAE and MSE ) . To sum up , we devise NeuralMD , an ML framework that incorporates a novel multi-grained group symmetric network architecture and second-order Newtonian mechanics , enabling accurate predictions of binding dynamics in a large timescale . Not only is such a timescale critical for understanding the dynamic nature of the ligand-protein complex , but our work marks the first approach in developing a framework to predict coordinates for MD simulation in protein-ligand binding . We quantitatively and qualitatively verify that NeuralMD achieves superior performance on 13 binding dynamics tasks . Currently , we are using the MISATO dataset , a protein-ligand dynamics dataset with a large timestep . However , NeuralMD is agnostic to the timestep , and it can also be applied to binding dynamics datasets with timestep as a femtosecond .